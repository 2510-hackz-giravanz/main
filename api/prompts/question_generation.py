"""質問生成用のプロンプトテンプレート"""

import random
from langchain_core.prompts import ChatPromptTemplate


def get_question_generation_prompt(seed: int = None) -> ChatPromptTemplate:
    """
    サッカー診断用の質問を生成するためのプロンプトテンプレートを返す

    Args:
        seed: ランダムシード（指定すると毎回異なる質問の視点を促す）

    Returns:
        ChatPromptTemplate: 質問生成用のプロンプト
    """
    # シードが指定されていない場合はランダムに生成
    if seed is None:
        seed = random.randint(1, 1000000)

    # 多様性を持たせるためのテーマ候補（観戦者・ファン視点）
    themes = [
        "試合観戦の楽しみ方",
        "好きな選手のタイプ",
        "応援スタイル",
        "試合の見どころ",
        "サッカーの魅力",
        "チーム選びの基準",
        "観戦時の感情",
        "サッカー文化への関わり方",
        "理想のプレースタイル",
        "サッカーから学ぶこと",
        "日常生活での価値観",
        "人間関係の築き方",
    ]

    # シードを使って毎回異なるテーマの組み合わせを選択
    random.seed(seed)
    selected_themes = random.sample(themes, min(6, len(themes)))
    themes_hint = "、".join(selected_themes)

    system_message = f"""あなたはサッカーと心理学の専門家です。

念能力の6系統について:

1. **強化系**: モノの持つ働きや力を強くする
   - 特徴: 体力がある、力が強い、回復力が高い、基礎を大事にする
   - サッカー例: フィジカルの強さ、持久力、基本技術の反復練習

2. **放出系**: オーラを飛ばす
   - 特徴: パス・シュートがうまい、遠くに飛ばす能力
   - サッカー例: ロングパス、ミドルシュート、正確なクロス

3. **変化系**: オーラの性質を変える
   - 特徴: 相手を惑わすトリックプレーがうまい
   - サッカー例: フェイント、ドリブルテクニック、予測不能な動き

4. **操作系**: 物質や生物を操る
   - 特徴: ツール・アイテムにこだわりがある
   - サッカー例: スパイク、ボール、用具へのこだわり、戦術理解

5. **具現化系**: 何かを具現化する
   - 特徴: 想像力、創造性が豊か
   - サッカー例: 独創的なプレー、新しい戦術の発案、芸術的なゴール

6. **特質系**: 他に類のない特殊なオーラ
   - 特徴: 以上に挙げた5種にはない特殊な能力・雰囲気を持ち合わせている
   - サッカー例: カリスマ性、天性の勘、異次元のプレー

---

サッカーにちなんだ質問を10個作成し、各質問に4つの選択肢を用意してください。

重要な制約:
- 各質問には必ず4つの選択肢を用意すること
- 各選択肢は上記の念能力の系統（強化系、放出系、変化系、操作系、具現化系、特質系）のいずれか1つを示唆する内容にすること
- 10個の質問全体で、6系統がバランスよく登場するようにすること
- 質問文と選択肢は日本語で作成すること
- 質問は多様性を持たせること（プレースタイル、練習方法、メンタル、チームでの役割など）

**創造性のためのヒント（毎回異なる視点で質問を作成すること）**:
- 以下のテーマを参考に、ユニークで新鮮な質問を考えてください: {themes_hint}
- 同じような質問や選択肢の繰り返しを避け、毎回異なる角度から性格を診断できる質問を作成してください
- 具体的なシチュエーションや状況設定を工夫して、回答者が自分を投影しやすい質問にしてください
- ランダム性ID: {seed}（このIDを参考に、他の生成とは異なる独自の質問セットを作成してください）
"""

    human_message = "サッカー診断用の質問セット（10個の質問、各4択）を生成してください。必ず前回とは異なる、新鮮でユニークな質問を作成してください。"

    return ChatPromptTemplate.from_messages(
        [
            ("system", system_message),
            ("human", human_message),
        ]
    )
