"""質問生成用のプロンプトテンプレート"""

import random
from langchain_core.prompts import ChatPromptTemplate


def get_question_generation_prompt(seed: int = None) -> ChatPromptTemplate:
    """
    サッカー診断用の質問を生成するためのプロンプトテンプレートを返す

    Args:
        seed: ランダムシード（指定すると毎回異なる質問の視点を促す）

    Returns:
        ChatPromptTemplate: 質問生成用のプロンプト
    """
    # シードが指定されていない場合はランダムに生成
    if seed is None:
        seed = random.randint(1, 1000000)

    # 多様性を持たせるためのテーマ候補（観戦者・ファン視点）
    themes = [
        "試合観戦の楽しみ方",
        "好きな選手のタイプ",
        "応援スタイル",
        "試合の見どころ",
        "サッカーの魅力",
        "チーム選びの基準",
        "観戦時の感情",
        "サッカー文化への関わり方",
        "理想のプレースタイル",
        "サッカーから学ぶこと",
        "日常生活での価値観",
        "人間関係の築き方",
    ]

    # シードを使って毎回異なるテーマの組み合わせを選択
    random.seed(seed)
    selected_themes = random.sample(themes, min(6, len(themes)))
    themes_hint = "、".join(selected_themes)

    system_message = f"""あなたはサッカーと心理学の専門家です。
サッカーにちなんだ質問を10個作成し、各質問に4つの選択肢を用意してください。

## 念能力の6系統の特性（選択肢設計の参考）

各選択肢は以下の念系統の特性を反映させてください（質問文に系統名は含めないこと）:

1. **強化系の特性**: 
   - 体力・基礎重視・努力・継続・素直・まっすぐ
   - 行動例: 諦めない、愚直に努力、基礎を大切にする、最後まで走り続ける

2. **放出系の特性**:
   - 直線的・外向的・遠くに届ける・放つ・影響を広げる
   - 行動例: 自分の力を外に発揮、チームを鼓舞する、積極的に声をかける

3. **変化系の特性**:
   - トリック・惑わす・変幻自在・予測不能・気まぐれ・柔軟
   - 行動例: アレンジ好き、型にはまらない、創意工夫、トリッキーなプレー

4. **操作系の特性**:
   - 道具・戦略・計画・コントロール・理論派・マネジメント
   - 行動例: 計画的、論理的、システム重視、戦術を重視、用具にこだわる

5. **具現化系の特性**:
   - 想像・創造・芸術・こだわり・完璧主義・独創性
   - 行動例: イメージを形にする、美意識、独自性、完成度を追求

6. **特質系の特性**:
   - 特殊・カリスマ・異質・直感・天性・独特の存在感
   - 行動例: 本能的判断、常識外れ、天性の勘、カリスマ性

## 重要な制約

- 各質問には必ず4つの選択肢を用意すること
- 質問文と選択肢は日本語で作成すること
- 質問文には念系統の名前を直接含めないこと
- 各質問の選択肢は、上記の念系統の特性を反映させること
- **選択肢の順序は必ずランダムにシャッフルすること**（メタ読み防止）
  - 同じ念系統の特性を持つ選択肢が、常に同じ位置に来ないようにすること
  - 例: 強化系の特性を持つ選択肢が、常に1番目に来ないようにする
- 質問は多様性を持たせること（プレースタイル、練習方法、メンタル、チームでの役割など）

## 創造性のためのヒント（毎回異なる視点で質問を作成すること）

- 以下のテーマを参考に、ユニークで新鮮な質問を考えてください: {themes_hint}
- 同じような質問や選択肢の繰り返しを避け、毎回異なる角度から性格を診断できる質問を作成してください
- 具体的なシチュエーションや状況設定を工夫して、回答者が自分を投影しやすい質問にしてください
- ランダム性ID: {seed}（このIDを参考に、他の生成とは異なる独自の質問セットを作成してください）
"""

    human_message = "サッカー診断用の質問セット（10個の質問、各4択）を生成してください。必ず前回とは異なる、新鮮でユニークな質問を作成してください。"

    return ChatPromptTemplate.from_messages(
        [
            ("system", system_message),
            ("human", human_message),
        ]
    )
